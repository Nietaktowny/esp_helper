name: Test qemu lib_tests

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: espressif/idf
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          path: "esp_helper"
      - name: Build all test projects.
        run: |
            pwd
            ls -la
            cd esp_helper/projects/lib_tests/
            python clean_all.py
            python build_all.py
      - name: Run pytest on qemu.
        run: |
            pytest pytest_logger.py --embedded-services=qemu,idf -m qemu --junitxml "junit/test_reports"
            pip install junit2html
            junit2html junit/test_reports
